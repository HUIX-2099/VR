<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
    <title>A-Frame VR</title>
    <style>
      html, body { height: 100%; margin: 0; background: #202225; color: #e6e6e6; font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif; }
      .top-note { position: fixed; right: 12px; bottom: 12px; opacity: .8; font-size: 12px; max-width: 320px; text-align: right; z-index: 9; }
    </style>
    <script src="https://unpkg.com/aframe@1.5.0/dist/aframe.min.js"></script>
    <script src="https://unpkg.com/aframe-extras@6.1.1/dist/aframe-extras.min.js"></script>
  </head>
  <body>
    <div class="top-note">HTTPS or localhost required. Mobile auto-attempts VR; if blocked by the browser, tap the VR icon.</div>

    <a-scene id="scene"
             renderer="colorManagement: true"
             vr-mode-ui="enabled: true"
             device-orientation-permission-ui>
      <a-assets>
        <a-asset-item id="museum" src="./museum.glb"></a-asset-item>
      </a-assets>

      <a-entity id="rig" position="0 1.65 4">
        <a-entity id="camera" camera look-controls="pointerLockEnabled: true" wasd-controls="acceleration: 40"></a-entity>
      </a-entity>

      <a-entity light="type: directional; intensity: 1.2" position="1 2 1"></a-entity>
      <a-entity gltf-model="#museum" position="0 0 0" scale="1 1 1"></a-entity>

      <a-plane rotation="-90 0 0" width="50" height="50" color="#55CAA6"></a-plane>
      <a-box position="0 1.25 0" color="#AAAAAA"></a-box>
    </a-scene>

    <script>
      (function(){
        const scene = document.getElementById('scene');
        function isMobile(){ return /Android|iPhone|iPad|iPod|Mobile/i.test(navigator.userAgent); }

        async function tryEnterVR(){
          try {
            // Prefer WebXR immersive-vr if available
            if (navigator.xr && await navigator.xr.isSessionSupported('immersive-vr')) {
              await scene.enterVR();
              return true;
            }
            // Fallback: A-Frame Cardboard/magic window
            await scene.enterVR();
            return true;
          } catch(e){
            console.warn('Auto-enter VR failed (likely needs a gesture)', e);
            return false;
          }
        }

        scene.addEventListener('loaded', async () => {
          if (isMobile()) {
            const entered = await tryEnterVR();
            if (!entered) {
              // If blocked, enable one-time gesture fallback
              const gesture = async () => {
                window.removeEventListener('touchend', gesture);
                window.removeEventListener('click', gesture);
                await tryEnterVR();
              };
              window.addEventListener('touchend', gesture, { once: true });
              window.addEventListener('click', gesture, { once: true });
            }
          }
        });
      })();
    </script>
  </body>
</html>
